var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function a(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let o,r;function c(t,e){return o||(o=document.createElement("a")),o.href=e,t===o.href}function l(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function m(){return p(" ")}function b(){return p("")}function k(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function T(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function $(t,e){t.value=null==e?"":e}function y(t,e){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e)return void(s.selected=!0)}t.selectedIndex=-1}function w(t){r=t}function v(){const t=function(){if(!r)throw new Error("Function called outside component initialization");return r}();return(e,n)=>{const s=t.$$.callbacks[e];if(s){const a=function(t,e,n=!1){const s=document.createEvent("CustomEvent");return s.initCustomEvent(t,n,!1,e),s}(e,n);s.slice().forEach((e=>{e.call(t,a)}))}}}const A=[],E=[],U=[],_=[],S=Promise.resolve();let N=!1;function I(t){U.push(t)}let x=!1;const D=new Set;function C(){if(!x){x=!0;do{for(let t=0;t<A.length;t+=1){const e=A[t];w(e),L(e.$$)}for(w(null),A.length=0;E.length;)E.pop()();for(let t=0;t<U.length;t+=1){const e=U[t];D.has(e)||(D.add(e),e())}U.length=0}while(A.length);for(;_.length;)_.pop()();N=!1,x=!1,D.clear()}}function L(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(I)}}const P=new Set;let O;function H(){O={r:0,c:[],p:O}}function j(){O.r||s(O.c),O=O.p}function G(t,e){t&&t.i&&(P.delete(t),t.i(e))}function R(t,e,n,s){if(t&&t.o){if(P.has(t))return;P.add(t),O.c.push((()=>{P.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function Y(t){t&&t.c()}function z(t,n,i,o){const{fragment:r,on_mount:c,on_destroy:l,after_update:u}=t.$$;r&&r.m(n,i),o||I((()=>{const n=c.map(e).filter(a);l?l.push(...n):s(n),t.$$.on_mount=[]})),u.forEach(I)}function B(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function M(t,e){-1===t.$$.dirty[0]&&(A.push(t),N||(N=!0,S.then(C)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function F(e,a,i,o,c,l,u,f=[-1]){const h=r;w(e);const p=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(h?h.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:a.target||h.$$.root};u&&u(p.root);let m=!1;if(p.ctx=i?i(e,a.props||{},((t,n,...s)=>{const a=s.length?s[0]:n;return p.ctx&&c(p.ctx[t],p.ctx[t]=a)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](a),m&&M(e,t)),n})):[],p.update(),m=!0,s(p.before_update),p.fragment=!!o&&o(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();a.intro&&G(e.$$.fragment),z(e,a.target,a.anchor,a.customElement),C()}w(h)}class J{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const K=window.location.toString().includes(":5000")?"http://localhost:8080":"";class q{constructor(){this.state="UNAUTH",this.backends={},this.session=null}subscribe(t,e){if("AUTHED"!==this.state)throw new Error("Not authenticated");this._subscribeToBackend(t,e)}async isAuthenticated(){if("UNAUTH"===this.state){let t=JSON.parse(localStorage.getItem("session"));if(t){this.state="PENDING_AUTH";let e=await fetch(K+"/api/session",{headers:{Authorization:t.token}});return 200===e.status?(this.state="AUTHED",this.session=await e.json(),!0):(this.state="UNAUTH",this.authenticationPromise=null,!1)}return!1}}async authenticate(t,e){this.state="PENDING_AUTH";let n=await fetch(K+"/api/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})});if(200===n.status){let t=await n.json();return this.state="AUTHED",this.session=t,localStorage.setItem("session",JSON.stringify(t)),!0}return this.state="UNAUTH",this.authenticationPromise=null,!1}async signUp(t,e){this.state="PENDING_AUTH";let n=await fetch(K+"/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})});if(200===n.status){let t=await n.json();return this.state="AUTHED",this.session=t,localStorage.setItem("session",JSON.stringify(t)),!0}return this.state="UNAUTH",this.authenticationPromise=null,!1}async addPlaylist(t){if(200===(await fetch(K+"/api/playlists",{method:"POST",headers:{Authorization:this.session.token,"Content-Type":"application/json"},body:JSON.stringify(t)})).status)return this.backends.PLAYLIST_LIST&&this.backends.PLAYLIST_LIST.refresh(),!0;throw new Error("Failed to create playlist")}async getUploadRequestInfo(t,e){const n=await fetch(K+"/api/storage/upload_key?"+new URLSearchParams({filename:t,contentType:e}),{headers:{Authorization:this.session.token}});if(200!==n.status)throw new Error("Failed to get track upload key");return await n.json()}async submitTrack(t,e,n){if(200!==(await fetch(K+"/api/tracks",{method:"POST",headers:{Authorization:this.session.token,"Content-Type":"application/json"},body:JSON.stringify({title:t,artist:e,publicUrl:n})})).status)throw new Error("Failed to submit track");return this.backends.TRACK_LIST.refresh(),!0}async deleteTrack(t){if(200!==(await fetch(K+"/api/tracks/"+t,{method:"DELETE",headers:{Authorization:this.session.token}})).status)throw new Error("Error deleting track");this.backends.TRACK_LIST.refresh(),this.backends.PLAYLIST_LIST.refresh()}async addTrackToPlaylist(t,e){if(200!==(await fetch(K+"/api/playlists/"+t+"/tracks",{method:"PUT",headers:{Authorization:this.session.token,"Content-Type":"application/json"},body:JSON.stringify({id:e})})).status)throw new Error("Error adding track to playlist");this.backends.PLAYLIST_LIST.refresh()}async removeTrackFromPlaylist(t,e){if(200!==(await fetch(K+"/api/playlists/"+t+"/tracks/"+e,{method:"DELETE",headers:{Authorization:this.session.token}})).status)throw new Error("Error deleting track from playlist")}signOut(){this.state="UNAUTH",this.session=null,localStorage.removeItem("session"),this.backends={}}_subscribeToBackend(t,e){if(!this.backends[t])if("TRACK_LIST"==t)this.backends[t]=new Q(this.session);else if("USER"==t)this.backends[t]=new W(this.session);else{if("PLAYLIST_LIST"!=t)throw new Error(`Invalid channel ${t}`);this.backends[t]=new V(this.session)}this.backends[t].subscribe(e)}}class Q{constructor(t){this.session=t,this.state="NOT_YET_USED",this.callbacks=[]}subscribe(t){"NOT_YET_USED"===this.state?(this.callbacks.push(t),this.loadData()):"DATA_REQUESTED"===this.state?this.callbacks.push(t):"DATA_LOADED"===this.state&&t(this.data)}async loadData(){this.state="DATA_REQUESTED";const t=await fetch(K+"/api/tracks",{headers:{Authorization:this.session.token}});this.data=await t.json(),this.state="DATA_LOADED",this.callbacks.forEach((t=>t(this.data)))}refresh(){this.loadData()}}class V{constructor(t){this.session=t,this.state="NOT_YET_USED",this.callbacks=[]}subscribe(t){"NOT_YET_USED"===this.state?(this.state="DATA_REQUESTED",this.callbacks.push(t),this.loadData()):"DATA_REQUESTED"===this.state?this.callbacks.push(t):"DATA_LOADED"===this.state&&(this.callbacks.push(t),t(this.data))}async loadData(){const t=await fetch(K+"/api/playlists",{headers:{Authorization:this.session.token}});this.data=await t.json(),this.state="DATA_LOADED",this.callbacks.forEach((t=>t(this.data)))}refresh(){this.loadData()}}class W{constructor(t){this.session=t}subscribe(t){t(this.session.user)}}function X(e){let n,a,i,o,r,c,l,f,p,b,T;return{c(){n=h("label"),n.textContent="Username",a=m(),i=h("input"),o=m(),r=h("label"),r.textContent="Password",c=m(),l=h("input"),f=m(),p=h("button"),p.textContent="Log In",g(n,"for","login-username"),g(i,"id","login-username"),g(r,"for","login-password"),g(l,"type","password"),g(l,"id","login-password"),g(p,"type","button")},m(t,s){u(t,n,s),u(t,a,s),u(t,i,s),$(i,e[0]),u(t,o,s),u(t,r,s),u(t,c,s),u(t,l,s),$(l,e[1]),u(t,f,s),u(t,p,s),b||(T=[k(i,"input",e[3]),k(l,"input",e[4]),k(p,"click",e[2])],b=!0)},p(t,[e]){1&e&&i.value!==t[0]&&$(i,t[0]),2&e&&l.value!==t[1]&&$(l,t[1])},i:t,o:t,d(t){t&&d(n),t&&d(a),t&&d(i),t&&d(o),t&&d(r),t&&d(c),t&&d(l),t&&d(f),t&&d(p),b=!1,s(T)}}}function Z(t,e,n){const s=v();let a="",i="";return[a,i,async function(t){s("loginSubmit",{username:a,password:i})},function(){a=this.value,n(0,a)},function(){i=this.value,n(1,i)}]}class tt extends J{constructor(t){super(),F(this,t,Z,X,i,{})}}function et(e){let n,a,i,o,r,c,l,f,p,b,T;return{c(){n=h("label"),n.textContent="Username",a=m(),i=h("input"),o=m(),r=h("label"),r.textContent="Password",c=m(),l=h("input"),f=m(),p=h("button"),p.textContent="Sign Up",g(n,"for","login-username"),g(i,"id","login-username"),g(r,"for","login-password"),g(l,"type","password"),g(l,"id","login-password"),g(p,"type","button")},m(t,s){u(t,n,s),u(t,a,s),u(t,i,s),$(i,e[0]),u(t,o,s),u(t,r,s),u(t,c,s),u(t,l,s),$(l,e[1]),u(t,f,s),u(t,p,s),b||(T=[k(i,"input",e[3]),k(l,"input",e[4]),k(p,"click",e[2])],b=!0)},p(t,[e]){1&e&&i.value!==t[0]&&$(i,t[0]),2&e&&l.value!==t[1]&&$(l,t[1])},i:t,o:t,d(t){t&&d(n),t&&d(a),t&&d(i),t&&d(o),t&&d(r),t&&d(c),t&&d(l),t&&d(f),t&&d(p),b=!1,s(T)}}}function nt(t,e,n){const s=v();let a="",i="";return[a,i,async function(){s("signupSubmit",{username:a,password:i})},function(){a=this.value,n(0,a)},function(){i=this.value,n(1,i)}]}class st extends J{constructor(t){super(),F(this,t,nt,et,i,{})}}function at(t,e,n){const s=t.slice();return s[8]=e[n],s}function it(e){let n;return{c(){n=h("p"),n.textContent="Fetching playlists..."},m(t,e){u(t,n,e)},p:t,d(t){t&&d(n)}}}function ot(t){let e,n,a,i,o,r,c,p,b,T,y,w,v,A=t[0],E=[];for(let e=0;e<A.length;e+=1)E[e]=rt(at(t,A,e));return{c(){for(let t=0;t<E.length;t+=1)E[t].c();e=m(),n=h("div"),a=h("h4"),a.textContent="Create new playlist",i=m(),o=h("label"),o.textContent="Playlist Name",r=m(),c=h("div"),p=h("input"),b=m(),T=h("div"),y=h("button"),y.textContent="Add Playlist",g(o,"for","new-playlist-name"),g(p,"id","new-playlist-name"),g(p,"type","text"),g(n,"class","new-playlist-form svelte-nhe55f")},m(s,d){for(let t=0;t<E.length;t+=1)E[t].m(s,d);u(s,e,d),u(s,n,d),l(n,a),l(n,i),l(n,o),l(n,r),l(n,c),l(c,p),$(p,t[1]),l(n,b),l(n,T),l(T,y),w||(v=[k(p,"input",t[6]),k(y,"click",t[3])],w=!0)},p(t,n){if(5&n){let s;for(A=t[0],s=0;s<A.length;s+=1){const a=at(t,A,s);E[s]?E[s].p(a,n):(E[s]=rt(a),E[s].c(),E[s].m(e.parentNode,e))}for(;s<E.length;s+=1)E[s].d(1);E.length=A.length}2&n&&p.value!==t[1]&&$(p,t[1])},d(t){f(E,t),t&&d(e),t&&d(n),w=!1,s(v)}}}function rt(t){let e,n,s,a,i,o=t[8].name+"";function r(){return t[5](t[8])}return{c(){e=h("div"),n=h("button"),s=p(o)},m(t,o){u(t,e,o),l(e,n),l(n,s),a||(i=k(n,"click",r),a=!0)},p(e,n){t=e,1&n&&o!==(o=t[8].name+"")&&T(s,o)},d(t){t&&d(e),a=!1,i()}}}function ct(e){let n;function s(t,e){return t[0]?ot:it}let a=s(e),i=a(e);return{c(){i.c(),n=b()},m(t,e){i.m(t,e),u(t,n,e)},p(t,[e]){a===(a=s(t))&&i?i.p(t,e):(i.d(1),i=a(t),i&&(i.c(),i.m(n.parentNode,n)))},i:t,o:t,d(t){i.d(t),t&&d(n)}}}function lt(t,e,n){const s=v();let{backend:a}=e,i=null;function o(t){s("showPlaylist",t)}a.subscribe("PLAYLIST_LIST",(t=>{n(0,i=t)}));let r="";return t.$$set=t=>{"backend"in t&&n(4,a=t.backend)},[i,r,o,async function(){let t={name:r};n(1,r=""),await a.addPlaylist(t)},a,t=>o(t),function(){r=this.value,n(1,r)}]}class ut extends J{constructor(t){super(),F(this,t,lt,ct,i,{backend:4})}}function dt(t,e,n){const s=t.slice();return s[4]=e[n],s}function ft(t){let e,n,s,a,i,o,r,f,b,$,y,w,v,A,E,U,_=t[4].title+"",S=t[4].artist+"";function N(){return t[2](t[4])}return{c(){e=h("div"),n=h("div"),s=p(_),a=m(),i=h("div"),o=p(S),r=m(),f=h("audio"),b=h("source"),y=m(),w=h("div"),v=h("button"),v.textContent="Delete",A=m(),g(n,"class","track-name"),g(i,"class","track-artist"),c(b.src,$=t[4].publicUrl)||g(b,"src",$),g(b,"type","audio/mpeg"),f.controls=!0,g(f,"class","track-player svelte-jbz85m"),g(w,"class","track-ctrl"),g(e,"class","track svelte-jbz85m")},m(t,c){u(t,e,c),l(e,n),l(n,s),l(e,a),l(e,i),l(i,o),l(e,r),l(e,f),l(f,b),l(e,y),l(e,w),l(w,v),l(e,A),E||(U=k(v,"click",N),E=!0)},p(e,n){t=e,1&n&&_!==(_=t[4].title+"")&&T(s,_),1&n&&S!==(S=t[4].artist+"")&&T(o,S),1&n&&!c(b.src,$=t[4].publicUrl)&&g(b,"src",$)},d(t){t&&d(e),E=!1,U()}}}function ht(e){let n,s=e[0],a=[];for(let t=0;t<s.length;t+=1)a[t]=ft(dt(e,s,t));return{c(){for(let t=0;t<a.length;t+=1)a[t].c();n=b()},m(t,e){for(let n=0;n<a.length;n+=1)a[n].m(t,e);u(t,n,e)},p(t,[e]){if(3&e){let i;for(s=t[0],i=0;i<s.length;i+=1){const o=dt(t,s,i);a[i]?a[i].p(o,e):(a[i]=ft(o),a[i].c(),a[i].m(n.parentNode,n))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},i:t,o:t,d(t){f(a,t),t&&d(n)}}}function pt(t,e,n){const s=v();function a(t){s("deleteTrack",t)}let{tracks:i}=e;return t.$$set=t=>{"tracks"in t&&n(0,i=t.tracks)},[i,a,t=>a(t)]}class mt extends J{constructor(t){super(),F(this,t,pt,ht,i,{tracks:0})}}function bt(t,e,n){const s=t.slice();return s[5]=e[n],s}function kt(t){let e,n,s,a,i,o=t[5].title+"",r=t[5].artist+"";return{c(){e=h("option"),n=p(o),s=p(" by "),a=p(r),e.__value=i=t[5],e.value=e.__value},m(t,i){u(t,e,i),l(e,n),l(e,s),l(e,a)},p(t,s){1&s&&o!==(o=t[5].title+"")&&T(n,o),1&s&&r!==(r=t[5].artist+"")&&T(a,r),1&s&&i!==(i=t[5])&&(e.__value=i,e.value=e.__value)},d(t){t&&d(e)}}}function gt(e){let n,a,i,o,r,c,p=e[0],b=[];for(let t=0;t<p.length;t+=1)b[t]=kt(bt(e,p,t));return{c(){n=h("select"),a=h("option"),a.textContent="Select a track";for(let t=0;t<b.length;t+=1)b[t].c();i=m(),o=h("button"),o.textContent="Add",a.__value="",a.value=a.__value,void 0===e[1]&&I((()=>e[3].call(n))),g(o,"type","button")},m(t,s){u(t,n,s),l(n,a);for(let t=0;t<b.length;t+=1)b[t].m(n,null);y(n,e[1]),u(t,i,s),u(t,o,s),r||(c=[k(n,"change",e[3]),k(o,"click",e[2])],r=!0)},p(t,[e]){if(1&e){let s;for(p=t[0],s=0;s<p.length;s+=1){const a=bt(t,p,s);b[s]?b[s].p(a,e):(b[s]=kt(a),b[s].c(),b[s].m(n,null))}for(;s<b.length;s+=1)b[s].d(1);b.length=p.length}3&e&&y(n,t[1])},i:t,o:t,d(t){t&&d(n),f(b,t),t&&d(i),t&&d(o),r=!1,s(c)}}}function Tt(t,e,n){const s=v();let a,{allTracks:i}=e;return t.$$set=t=>{"allTracks"in t&&n(0,i=t.allTracks)},[i,a,function(){s("addTrack",a)},function(){a=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(1,a),n(0,i)}]}class $t extends J{constructor(t){super(),F(this,t,Tt,gt,i,{allTracks:0})}}function yt(t){let e,n,s,a,i,o=At(t[2],t[0]).name+"";return a=new mt({props:{tracks:At(t[2],t[0]).tracks}}),a.$on("deleteTrack",t[3]),{c(){e=h("h2"),n=p(o),s=m(),Y(a.$$.fragment)},m(t,o){u(t,e,o),l(e,n),u(t,s,o),z(a,t,o),i=!0},p(t,e){(!i||5&e)&&o!==(o=At(t[2],t[0]).name+"")&&T(n,o);const s={};5&e&&(s.tracks=At(t[2],t[0]).tracks),a.$set(s)},i(t){i||(G(a.$$.fragment,t),i=!0)},o(t){R(a.$$.fragment,t),i=!1},d(t){t&&d(e),t&&d(s),B(a,t)}}}function wt(t){let e,n;return e=new $t({props:{allTracks:t[1]}}),e.$on("addTrack",t[4]),{c(){Y(e.$$.fragment)},m(t,s){z(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.allTracks=t[1]),e.$set(s)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function vt(t){let e,n,s,a=t[2]&&yt(t),i=t[1]&&wt(t);return{c(){a&&a.c(),e=m(),i&&i.c(),n=b()},m(t,o){a&&a.m(t,o),u(t,e,o),i&&i.m(t,o),u(t,n,o),s=!0},p(t,[s]){t[2]?a?(a.p(t,s),4&s&&G(a,1)):(a=yt(t),a.c(),G(a,1),a.m(e.parentNode,e)):a&&(H(),R(a,1,1,(()=>{a=null})),j()),t[1]?i?(i.p(t,s),2&s&&G(i,1)):(i=wt(t),i.c(),G(i,1),i.m(n.parentNode,n)):i&&(H(),R(i,1,1,(()=>{i=null})),j())},i(t){s||(G(a),G(i),s=!0)},o(t){R(a),R(i),s=!1},d(t){a&&a.d(t),t&&d(e),i&&i.d(t),t&&d(n)}}}function At(t,e){return t.find((t=>t.id==e))}function Et(t,e,n){let{playlistId:s}=e,{backend:a}=e,i=null,o=null;return a.subscribe("TRACK_LIST",(t=>{n(1,i=t)})),a.subscribe("PLAYLIST_LIST",(t=>{n(2,o=t)})),t.$$set=t=>{"playlistId"in t&&n(0,s=t.playlistId),"backend"in t&&n(5,a=t.backend)},[s,i,o,function(t){let e=t.detail;a.removeTrackFromPlaylist(s,e.id)},async function(t){let e=t.detail;a.addTrackToPlaylist(s,e.id)},a]}class Ut extends J{constructor(t){super(),F(this,t,Et,vt,i,{playlistId:0,backend:5})}}function _t(e){let n,a,i,o,r,c,f,b,T,y,w,v,A,E,U,_,S,N,I,x,D,C,L,P,O;return{c(){n=h("div"),a=h("div"),i=h("label"),i.textContent="Title",o=m(),r=h("input"),f=m(),b=h("div"),T=h("label"),T.textContent="Artist",y=m(),w=h("input"),A=m(),E=h("div"),U=h("label"),U.textContent="Upload",_=m(),S=h("input"),I=m(),x=h("div"),D=h("button"),C=p("Add"),g(i,"for","new-track-title"),g(r,"id","new-track-title"),r.disabled=c="SUBMITTING"==e[4],g(r,"class","svelte-cv31d2"),g(a,"class","track-name"),g(T,"for","new-track-artist"),g(w,"id","new-track-artist"),w.disabled=v="SUBMITTING"==e[4],g(w,"class","svelte-cv31d2"),g(b,"class","track-artist"),g(U,"for","new-track-file-upload"),g(S,"type","file"),g(S,"id","new-track-file-upload"),S.disabled=N="SUBMITTING"==e[4],g(S,"class","svelte-cv31d2"),g(E,"class","track-player"),D.disabled=L="SUBMITTING"==e[4],g(x,"class","track-ctrl svelte-cv31d2"),g(n,"class","track svelte-cv31d2")},m(t,s){u(t,n,s),l(n,a),l(a,i),l(a,o),l(a,r),$(r,e[2]),e[8](r),l(n,f),l(n,b),l(b,T),l(b,y),l(b,w),$(w,e[3]),l(n,A),l(n,E),l(E,U),l(E,_),l(E,S),l(n,I),l(n,x),l(x,D),l(D,C),P||(O=[k(r,"input",e[7]),k(w,"input",e[9]),k(S,"change",e[10]),k(D,"click",e[5])],P=!0)},p(t,[e]){16&e&&c!==(c="SUBMITTING"==t[4])&&(r.disabled=c),4&e&&r.value!==t[2]&&$(r,t[2]),16&e&&v!==(v="SUBMITTING"==t[4])&&(w.disabled=v),8&e&&w.value!==t[3]&&$(w,t[3]),16&e&&N!==(N="SUBMITTING"==t[4])&&(S.disabled=N),16&e&&L!==(L="SUBMITTING"==t[4])&&(D.disabled=L)},i:t,o:t,d(t){t&&d(n),e[8](null),P=!1,s(O)}}}function St(t,e,n){let s,a,{backend:i}=e;v();let o="",r="",c="READY";return t.$$set=t=>{"backend"in t&&n(6,i=t.backend)},[s,a,o,r,c,async function(t){n(4,c="SUBMITTING");let e=await i.getUploadRequestInfo(s[0].name,s[0].type);await async function(t,e){let n=await fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}});if(200!==n.status)throw new Error("Error uploading track file: "+n.statusText)}(e.signedUploadUrl,s[0]),await i.submitTrack(o,r,e.publicUrl),n(2,o=""),n(3,r=""),n(1,a.value="",a),n(4,c="READY")},i,function(){o=this.value,n(2,o)},function(t){E[t?"unshift":"push"]((()=>{a=t,n(1,a)}))},function(){r=this.value,n(3,r)},function(){s=this.files,n(0,s)}]}class Nt extends J{constructor(t){super(),F(this,t,St,_t,i,{backend:6})}}function It(e){let n;return{c(){n=h("p"),n.textContent="Loading..."},m(t,e){u(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function xt(t){let e,n,s,a;return e=new Nt({props:{backend:t[0]}}),s=new mt({props:{tracks:t[1]}}),s.$on("deleteTrack",t[2]),{c(){Y(e.$$.fragment),n=m(),Y(s.$$.fragment)},m(t,i){z(e,t,i),u(t,n,i),z(s,t,i),a=!0},p(t,n){const a={};1&n&&(a.backend=t[0]),e.$set(a);const i={};2&n&&(i.tracks=t[1]),s.$set(i)},i(t){a||(G(e.$$.fragment,t),G(s.$$.fragment,t),a=!0)},o(t){R(e.$$.fragment,t),R(s.$$.fragment,t),a=!1},d(t){B(e,t),t&&d(n),B(s,t)}}}function Dt(t){let e,n,s,a;const i=[xt,It],o=[];function r(t,e){return t[1]?0:1}return e=r(t),n=o[e]=i[e](t),{c(){n.c(),s=b()},m(t,n){o[e].m(t,n),u(t,s,n),a=!0},p(t,[a]){let c=e;e=r(t),e===c?o[e].p(t,a):(H(),R(o[c],1,1,(()=>{o[c]=null})),j(),n=o[e],n?n.p(t,a):(n=o[e]=i[e](t),n.c()),G(n,1),n.m(s.parentNode,s))},i(t){a||(G(n),a=!0)},o(t){R(n),a=!1},d(t){o[e].d(t),t&&d(s)}}}function Ct(t,e,n){let{backend:s}=e,a=null;return s.subscribe("TRACK_LIST",(t=>{n(1,a=t)})),t.$$set=t=>{"backend"in t&&n(0,s=t.backend)},[s,a,function(t){let e=t.detail;s.deleteTrack(e.id)}]}class Lt extends J{constructor(t){super(),F(this,t,Ct,Dt,i,{backend:0})}}function Pt(t){let e,n,s,a=t[2].username+"";return{c(){e=p("Hello "),n=p(a),s=p("!")},m(t,a){u(t,e,a),u(t,n,a),u(t,s,a)},p(t,e){4&e&&a!==(a=t[2].username+"")&&T(n,a)},d(t){t&&d(e),t&&d(n),t&&d(s)}}}function Ot(e){let n,s,a,i,o;return{c(){n=h("h2"),n.textContent="404 Not Found",s=m(),a=h("p"),i=p("No such page "),o=p(e[1])},m(t,e){u(t,n,e),u(t,s,e),u(t,a,e),l(a,i),l(a,o)},p(t,e){2&e&&T(o,t[1])},i:t,o:t,d(t){t&&d(n),t&&d(s),t&&d(a)}}}function Ht(t){let e,n,s,a;return s=new Ut({props:{backend:t[0],playlistId:t[1].payload}}),{c(){e=h("h2"),e.textContent="Playlist",n=m(),Y(s.$$.fragment)},m(t,i){u(t,e,i),u(t,n,i),z(s,t,i),a=!0},p(t,e){const n={};1&e&&(n.backend=t[0]),2&e&&(n.playlistId=t[1].payload),s.$set(n)},i(t){a||(G(s.$$.fragment,t),a=!0)},o(t){R(s.$$.fragment,t),a=!1},d(t){t&&d(e),t&&d(n),B(s,t)}}}function jt(t){let e,n,s,a;return s=new Lt({props:{backend:t[0]}}),{c(){e=h("h2"),e.textContent="Library",n=m(),Y(s.$$.fragment)},m(t,i){u(t,e,i),u(t,n,i),z(s,t,i),a=!0},p(t,e){const n={};1&e&&(n.backend=t[0]),s.$set(n)},i(t){a||(G(s.$$.fragment,t),a=!0)},o(t){R(s.$$.fragment,t),a=!1},d(t){t&&d(e),t&&d(n),B(s,t)}}}function Gt(t){let e,n,a,i,o,r,c,f,p,b,T,$,y,w,v,A,E,U,_,S,N,I=t[2]&&Pt(t);f=new ut({props:{backend:t[0]}}),f.$on("showPlaylist",t[4]);const x=[jt,Ht,Ot],D=[];function C(t,e){return"library"==t[1].screen?0:"playlist"==t[1].screen?1:2}return E=C(t),U=D[E]=x[E](t),{c(){e=h("div"),n=h("aside"),a=h("h1"),a.textContent="Aceplay",i=m(),I&&I.c(),o=m(),r=h("nav"),c=h("ul"),Y(f.$$.fragment),p=m(),b=h("li"),T=h("button"),T.textContent="Library",$=m(),y=h("li"),w=h("button"),w.textContent="Sign Out",v=m(),A=h("main"),U.c(),g(c,"class","svelte-15ljv7x"),g(n,"class","sidebar svelte-15ljv7x"),g(A,"class","main svelte-15ljv7x"),g(e,"class","grid svelte-15ljv7x")},m(s,d){u(s,e,d),l(e,n),l(n,a),l(n,i),I&&I.m(n,null),l(n,o),l(n,r),l(r,c),z(f,c,null),l(c,p),l(c,b),l(b,T),l(c,$),l(c,y),l(y,w),l(e,v),l(e,A),D[E].m(A,null),_=!0,S||(N=[k(T,"click",t[5]),k(w,"click",t[6])],S=!0)},p(t,[e]){t[2]?I?I.p(t,e):(I=Pt(t),I.c(),I.m(n,o)):I&&(I.d(1),I=null);const s={};1&e&&(s.backend=t[0]),f.$set(s);let a=E;E=C(t),E===a?D[E].p(t,e):(H(),R(D[a],1,1,(()=>{D[a]=null})),j(),U=D[E],U?U.p(t,e):(U=D[E]=x[E](t),U.c()),G(U,1),U.m(A,null))},i(t){_||(G(f.$$.fragment,t),G(U),_=!0)},o(t){R(f.$$.fragment,t),R(U),_=!1},d(t){t&&d(e),I&&I.d(),B(f),D[E].d(),S=!1,s(N)}}}function Rt(t,e,n){const s=v();let{backend:a}=e,i={screen:"library",payload:null},o=null;a.subscribe("USER",(t=>{n(2,o=t)}));return t.$$set=t=>{"backend"in t&&n(0,a=t.backend)},[a,i,o,s,function(t){n(1,i={screen:"playlist",payload:t.detail.id})},()=>n(1,i={screen:"library",payload:null}),()=>s("signOut")]}class Yt extends J{constructor(t){super(),F(this,t,Rt,Gt,i,{backend:0})}}function zt(e){let n,s,a,i,o,r,c,l;return a=new tt({}),a.$on("loginSubmit",e[2]),c=new st({}),c.$on("signupSubmit",e[3]),{c(){n=h("h2"),n.textContent="Login",s=m(),Y(a.$$.fragment),i=m(),o=h("h2"),o.textContent="Signup",r=m(),Y(c.$$.fragment)},m(t,e){u(t,n,e),u(t,s,e),z(a,t,e),u(t,i,e),u(t,o,e),u(t,r,e),z(c,t,e),l=!0},p:t,i(t){l||(G(a.$$.fragment,t),G(c.$$.fragment,t),l=!0)},o(t){R(a.$$.fragment,t),R(c.$$.fragment,t),l=!1},d(t){t&&d(n),t&&d(s),B(a,t),t&&d(i),t&&d(o),t&&d(r),B(c,t)}}}function Bt(e){let n,s;return n=new Yt({props:{backend:e[1]}}),n.$on("signOut",e[4]),{c(){Y(n.$$.fragment)},m(t,e){z(n,t,e),s=!0},p:t,i(t){s||(G(n.$$.fragment,t),s=!0)},o(t){R(n.$$.fragment,t),s=!1},d(t){B(n,t)}}}function Mt(e){let n;return{c(){n=h("p"),n.textContent="Loading..."},m(t,e){u(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function Ft(t){let e,n,s,a;const i=[Mt,Bt,zt],o=[];function r(t,e){return"PENDING_AUTH"==t[0]?0:"AUTHED"==t[0]?1:"UNAUTH"==t[0]?2:-1}return~(e=r(t))&&(n=o[e]=i[e](t)),{c(){n&&n.c(),s=b()},m(t,n){~e&&o[e].m(t,n),u(t,s,n),a=!0},p(t,[a]){let c=e;e=r(t),e===c?~e&&o[e].p(t,a):(n&&(H(),R(o[c],1,1,(()=>{o[c]=null})),j()),~e?(n=o[e],n?n.p(t,a):(n=o[e]=i[e](t),n.c()),G(n,1),n.m(s.parentNode,s)):n=null)},i(t){a||(G(n),a=!0)},o(t){R(n),a=!1},d(t){~e&&o[e].d(t),t&&d(s)}}}function Jt(t,e,n){let s="PENDING_AUTH",a=new q;return a.isAuthenticated().then((t=>{n(0,s=t?"AUTHED":"UNAUTH")})),[s,a,async function(t){let{username:e,password:i}=t.detail;n(0,s="PENDING_AUTH");let o=await a.authenticate(e,i);n(0,s=o?"AUTHED":"UNAUTH")},async function(t){let{username:e,password:i}=t.detail;n(0,s="PENDING_AUTH");let o=await a.signUp(e,i);n(0,s=o?"AUTHED":"UNAUTH")},function(){n(0,s="UNAUTH"),a.signOut()}]}return new class extends J{constructor(t){super(),F(this,t,Jt,Ft,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
